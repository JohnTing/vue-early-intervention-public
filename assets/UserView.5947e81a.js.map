{"version":3,"file":"UserView.5947e81a.js","sources":["../../src/Utils.ts","../../src/components/UserFrom1.vue","../../src/components/UserFrom2.vue","../../src/components/UserFrom3.vue","../../src/components/UserFrom4.vue","../../src/components/UserFrom5.vue","../../src/components/EndPage.vue","../../src/components/UserFrom0.vue","../../src/components/RegistrationTime.vue","../../src/components/RegistrationFrom.vue","../../src/views/UserView.vue"],"sourcesContent":["export default {};\r\n\r\n\r\nexport function formPayload2Record(payload: Event) {\r\n    \r\n    const allData: Record<string, string> = {};\r\n    const formData = new FormData(payload.target as HTMLFormElement);\r\n    for (const key of formData.keys()) {\r\n        allData[key] = formData.getAll(key).join(\"|\");\r\n    }\r\n    return allData;\r\n}","<script setup lang=\"ts\">\r\n    import { computed } from \"@vue/reactivity\";\r\n    import { ref, type Ref, type VNodeRef } from \"vue\";\r\n    import dayjs, { Dayjs } from \"dayjs\";\r\n    import { formPayload2Record } from \"@/Utils\";\r\n\r\n    const userTypes = [\"父母/監護人\", \"老師\", \"社工\", \"護理師\", \"其他\"];\r\n    const questionsAbouts = [\"動作\", \"語言\", \"學習\", \"情緒\", \"專注力、過動\", \"學前鑑定\"];\r\n    const userRelationship = ref(\"\");\r\n\r\n    const today = dayjs();\r\n    // const kidBirthdayStr: Ref<string> = ref(today.format('YYYY-MM-DD'));\r\n    // const kidBirthdayStr: Ref<string> = ref(\"\");\r\n    // const kidBirthday = computed(() => dayjs(kidBirthdayStr.value));\r\n    const pass: Ref<boolean | null> = ref(null);\r\n\r\n    const props = defineProps<{\r\n        disabled: boolean;\r\n    }>();\r\n\r\n    const emit = defineEmits<{\r\n        (e: \"kidBirthdayChange\", kidBirthday: Dayjs): void;\r\n        (e: \"submit\", payload: Record<string, string>, pass: boolean): void;\r\n    }>();\r\n    function submit(payload: Event) {\r\n        emit(\"submit\",  formPayload2Record(payload) , true);\r\n    }\r\n</script>\r\n<template>\r\n    <form id=\"from\" @submit.prevent=\"submit\">\r\n        <h5>1.兒童基本資料</h5>\r\n        <div class=\"row\">\r\n            <div class=\"col-md-4\">\r\n                兒童身份證號：\r\n                <input type=\"text\" class=\"form-control\" name=\"identityNumber\" required pattern=\"[A-Z][01][0-9]{8}\" :readonly=\"disabled\" />\r\n            </div>\r\n            <div class=\"col-md-4\">\r\n                兒童姓名：\r\n                <input type=\"text\" class=\"form-control\" name=\"childName\" required :readonly=\"disabled\" />\r\n            </div>\r\n        </div>\r\n        <br />\r\n        <div class=\"row\">\r\n            <div class=\"col-md-12\">\r\n                填寫人與兒童關係：\r\n                <div class=\"form-inline\">\r\n                    <div class=\"form-check-inline\" v-for=\"(v, i) in userTypes\">\r\n                        <label class=\"form-check-label\">\r\n                            <input class=\"form-check-input\" type=\"radio\" name=\"userRelationship\" :value=\"v\" v-model=\"userRelationship\" required :disabled=\"disabled\" />{{ v }}\r\n                        </label>\r\n                    </div>\r\n                    <div>\r\n                        <input\r\n                            type=\"text\"\r\n                            class=\"form-control\"\r\n                            name=\"userRelationshipOther\"\r\n                            :placeholder=\"userRelationship == userTypes.at(userTypes.length - 1) ? '請輸入關係' : ''\"\r\n                            :disabled=\"userRelationship != userTypes.at(userTypes.length - 1)\"\r\n                            :readonly=\"disabled\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"row\">\r\n            <div class=\"col-md-4\">\r\n                <label>\r\n                    填表人聯繫電話：\r\n                    <input type=\"text\" class=\"form-control\" placeholder=\"(務必留下可聯繫電話)\" name=\"phoneNumber\" required />\r\n                </label>\r\n            </div>\r\n        </div>\r\n        <div class=\"row\">\r\n        就診問題(可複選)：<br />\r\n\r\n        <label class=\"form-check-label\" v-for=\"q in questionsAbouts\">\r\n            <input class=\"form-check-input\" type=\"checkbox\" name=\"questionsAbouts\" :value=\"q\" :disabled=\"disabled\" />\r\n            {{ q }}&emsp;\r\n        </label>\r\n    </div>\r\n        <br />\r\n        <button v-if=\"!pass\" class=\"btn btn-primary\" type=\"submit\">確認</button>\r\n    </form>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { formPayload2Record } from '@/Utils';\r\nimport { computed } from '@vue/reactivity';\r\nimport dayjs from 'dayjs';\r\nimport { ref, type Ref } from 'vue';\r\n\r\n\r\n\r\n\r\nconst isEvaluate = ref(false);\r\nconst lastEvaluate: Ref<string | null> = ref(null);\r\nconst pass: Ref<boolean | null> = ref(null)\r\n\r\nconst props = defineProps<{\r\n  disabled: boolean\r\n}>()\r\n\r\nconst emit = defineEmits<{\r\n  (e: \"submit\", payload: Record<string, string>, pass: boolean): void;\r\n}>()\r\nfunction submit(payload: Event) {\r\n  const diff = dayjs().diff(lastEvaluate.value)\r\n  if (lastEvaluate.value && isEvaluate.value) {\r\n    pass.value = (diff / (1000 * 60 * 60 * 24)) > 365 - 61;\r\n  } else {\r\n    pass.value = true;\r\n  }\r\n  emit(\"submit\",  formPayload2Record(payload) , true);\r\n}\r\n\r\n\r\n\r\n</script>\r\n<template>\r\n  <form id=\"from\" @submit.prevent=\"submit\">\r\n    <h5>2.是否曾經於本院/他院看過兒童發展聯合評估門診？</h5>\r\n    <div class=\"col-md-12\">\r\n      <div class=\"form-check\">\r\n        <label class=\"form-check-label\">\r\n          <input type=\"radio\" class=\"form-check-input\" :value=\"false\" v-model=\"isEvaluate\" required\r\n            :disabled=\"disabled\">否\r\n        </label>\r\n      </div>\r\n      <div class=\"form-check\">\r\n        <label class=\"form-check-label\">\r\n          <input type=\"radio\" class=\"form-check-input\" :value=\"true\" v-model=\"isEvaluate\" required\r\n            :disabled=\"disabled\">是\r\n        </label>\r\n        <div v-if=\"isEvaluate\">\r\n          <div class=\"row\">\r\n            <div class=\"form-inline col-md-6\">\r\n              前次評估日期：<input type=\"date\" class=\"form-control\" name=\"lastEvaluate\" required v-model=\"lastEvaluate\"\r\n                :disabled=\"disabled\" />\r\n            </div>\r\n            <div class=\"form-inline col-md-6\">\r\n              建議複評時間（可不填）：<input type=\"date\" class=\"form-control\" name=\"SuggestEvaluate\" :disabled=\"disabled\" />\r\n            </div>\r\n            <div v-if=\"pass === false\">\r\n              <div class=\"alert alert-warning\">\r\n                無論於本院或他院評估一年內不得重評，查詢後若重覆看診，直接拒絕評估<br>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div v-if=\"!isEvaluate\" v-show=\"false\">\r\n          <div class=\"form-inline\">\r\n            前次評估日期：<input type=\"date\" class=\"form-control\" name=\"lastEvaluate\" value=\"\" :disabled=\"disabled\" />\r\n          </div>\r\n          <div class=\"form-inline\">\r\n            建議複評時間：<input type=\"date\" class=\"form-control\" name=\"SuggestEvaluate\" value=\"\" :disabled=\"disabled\" />（可不填）\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <br />\r\n    <button v-if=\"!pass\" class=\"btn btn-primary\" type=\"submit\">確認</button>\r\n\r\n\r\n  </form>\r\n</template>\r\n","<script setup lang=\"ts\">\r\nimport { formPayload2Record } from '@/Utils';\r\nimport { ref, type Ref } from 'vue';\r\n\r\n\r\nconst isSpecialDisease = ref(false)\r\n\r\nconst specialDiseaseList = [\r\n  \"神經系統\",\r\n  \"內分泌\",\r\n  \"罕見疾病\",\r\n  \"早產\"\r\n];\r\nconst pass: Ref<boolean | null> = ref(null)\r\n\r\n\r\nconst props = defineProps<{\r\n  disabled: boolean\r\n}>()\r\n\r\nconst emit = defineEmits<{\r\n  (e: \"submit\", payload: Record<string, string>, pass: boolean): void;\r\n}>()\r\nfunction submit(payload: Event) {\r\n  pass.value = true;\r\n  emit(\"submit\",  formPayload2Record(payload) , pass.value);\r\n}\r\n\r\n\r\n</script>\r\n<template>\r\n  <form id=\"from\" @submit.prevent=\"submit\">\r\n    <h5>3、是否有特殊疾病？</h5>\r\n    <div class=\"col-md-12\">\r\n      <div class=\"form-check\">\r\n        <label class=\"form-check-label\">\r\n          <input type=\"radio\" class=\"form-check-input\" :value=\"false\" v-model=\"isSpecialDisease\"\r\n            required :disabled=\"disabled\">否\r\n        </label>\r\n      </div>\r\n      <div class=\"form-check\">\r\n        <label class=\"form-check-label\">\r\n          <input type=\"radio\" class=\"form-check-input\" :value=\"true\" v-model=\"isSpecialDisease\"\r\n            required :disabled=\"disabled\">是\r\n        </label>\r\n        <div>\r\n          <div class=\"form-check form-check-inline\" v-for=\"v, i in specialDiseaseList\">\r\n            <label class=\"form-check-label\">\r\n            <input type=\"checkbox\" class=\"form-check-input\" name=\"specialDisease\" :value=\"v\" :disabled=\"disabled || !isSpecialDisease\">{{v}}\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <br />\r\n    <button v-if=\"!pass\" class=\"btn btn-primary\" type=\"submit\">確認</button>\r\n  </form>\r\n</template>","<script setup lang=\"ts\">\r\nimport { formPayload2Record } from '@/Utils';\r\nimport { ref, type Ref } from 'vue';\r\n\r\n\r\nconst pass: Ref<boolean | null> = ref(null)\r\nconst retardedList = [\"動作類\", \"語言\", \"認知、社會情緒、專注力、過動等\"]\r\n\r\n\r\n\r\nconst previousAssessments: Ref<string[]> = ref([])\r\n\r\nconst props = defineProps<{\r\n    disabled: boolean\r\n}>()\r\n\r\nconst emit = defineEmits<{\r\n  (e: \"submit\", payload: Record<string, string>, pass: boolean): void;\r\n}>()\r\nfunction submit(payload: Event) {\r\n  pass.value = previousAssessments.value.length >= 2;\r\n  emit(\"submit\",  formPayload2Record(payload) , pass.value);\r\n}\r\n\r\n</script>\r\n<template>\r\n  <form id=\"from\" @submit.prevent=\"submit\">\r\n    <h5>4、前次評估遲緩/臨界遲緩：</h5>\r\n    <div class=\"col-md-12\">\r\n      <div class=\"form-inline\" v-for=\"v, i in retardedList\">\r\n        <div class=\"form-check\">\r\n          <label class=\"form-check-label\">\r\n            <input type=\"checkbox\" class=\"form-check-input\" name=\"previousAssessment\" v-model=\"previousAssessments\"\r\n              :value=\"v\" :disabled=\"disabled\">{{ v }}\r\n          </label>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"alert alert-warning\" v-if=\"pass === false\">\r\n        ‧單一項目的發展遲緩，非本門診看診對象<br>\r\n        ‧認知、社會情緒、其它發展遲緩 &#8594; 系統直接跳轉掛「兒童心智科」<br>\r\n        ‧動作 &#8594; 系統直接跳轉掛「復健科」\r\n      </div>\r\n    </div>\r\n    <br />\r\n    <button v-if=\"!pass\" class=\"btn btn-primary\" type=\"submit\">確認</button>\r\n  </form>\r\n</template>","<script setup lang=\"ts\">\r\n  import {formPayload2Record} from \"@/Utils\";\r\n  import dayjs from \"dayjs\";\r\n  import {computed, ref, type Ref} from \"vue\";\r\n\r\n  const props = defineProps<{\r\n    kidBirthday: string;\r\n  }>();\r\n\r\n  type monthRootT = {\r\n    title: string;\r\n    min: number;\r\n    max: number;\r\n  };\r\n\r\n  type questionT = {\r\n    title: string;\r\n    special: boolean;\r\n    answer: boolean;\r\n  };\r\n\r\n  type monthQuestionsT = {\r\n    questions: questionT[];\r\n    image: string;\r\n  };\r\n\r\n  const monthRoots: Ref<Record<string, monthRootT>> = ref({});\r\n\r\n  const monthQuestions: Ref<monthQuestionsT> = ref({questions: [], image: \"\"} as monthQuestionsT);\r\n\r\n  fetch(\"assets/monthRoot.json\")\r\n    .then((value) => value.json())\r\n    .then((value) => {\r\n      monthRoots.value = value;\r\n    });\r\n\r\n  const monthQuestionTitle = computed(() => {\r\n    //console.log(props.kidBirthday);\r\n    const diff = dayjs().diff(dayjs(props.kidBirthday));\r\n    const diffday = diff / (1000 * 60 * 60 * 24);\r\n\r\n    let title = \"\";\r\n    for (const i in monthRoots.value) {\r\n      //console.log(diffday);\r\n      if (monthRoots.value[i].min <= diffday && monthRoots.value[i].max >= diffday) {\r\n        title = monthRoots.value[i].title;\r\n        fetch(i)\r\n          .then((value) => value.json())\r\n          .then((value: monthQuestionsT) => {\r\n            //console.log(value)\r\n\r\n            value.questions.forEach((v, i, a) => {\r\n              v.title = v.title.replace(/^\\d+\\./gm, \"\");\r\n              v.answer = !!v.answer;\r\n            });\r\n\r\n            monthQuestions.value = value;\r\n          });\r\n        break;\r\n      }\r\n    }\r\n    //console.log(title);\r\n    return title;\r\n  });\r\n\r\n  const pass: Ref<boolean | null> = ref(null);\r\n\r\n  const emit = defineEmits<{\r\n    (e: \"submit\", payload: Record<string, string>, pass: boolean): void;\r\n  }>();\r\n\r\n  function submit(payload: Event) {\r\n    const payloadData = formPayload2Record(payload);\r\n    const wrongAnswers: number[] = [];\r\n\r\n    monthQuestions.value.questions.forEach((v, i, a) => {\r\n      //console.log((i+1) + \"   \" + payloadData['q_' + i] + \"  \" + v.answer);\r\n      const answerStr = v.answer ? \"true\" : \"false\";\r\n\r\n      if (payloadData[\"q_\" + i] == answerStr) {\r\n        wrongAnswers.push(i + 1);\r\n      }\r\n\r\n      delete payloadData[\"q_\" + i];\r\n    });\r\n    payloadData[\"wrongAnswers\"] = wrongAnswers.join(\"|\");\r\n\r\n    emit(\"submit\", payloadData, !!monthQuestionTitle.value);\r\n  }\r\n</script>\r\n<template>\r\n  <form id=\"from\" @submit.prevent=\"submit\">\r\n    <h5>5、TAIPEI II 篩檢表</h5>\r\n    <div class=\"col-md-12\">\r\n      <div v-if=\"!monthQuestionTitle\">\r\n        <div class=\"text-center\">\r\n          <div class=\"spinner-border\" role=\"status\">\r\n            <span class=\"visually-hidden\">Loading...</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div v-if=\"monthQuestionTitle\">\r\n        <h6>{{ monthQuestionTitle }}</h6>\r\n        <div>\r\n          <div v-for=\"(v, i) in monthQuestions.questions\" :class=\"i % 2 == 0 ? 'q_white_line' : 'q_gray_line'\">\r\n            <div class=\"row\">\r\n              <div class=\"col-md-1\">\r\n                {{ i + 1 }}<span style=\"color: red\">{{ v.special ? \"&#9733;\" : \"\" }}</span>\r\n              </div>\r\n              <div class=\"col-md-9\">\r\n                <label class=\"form-check-label\">{{ v.title }}</label>\r\n              </div>\r\n\r\n              <div class=\"col-md-2 text-center\">\r\n                <input type=\"radio\" class=\"slist_radio_input\" :id=\"`q5t_${i}`\" :name=\"`q_${i}`\" required :value=\"true\" />\r\n                <label class=\"slist_radio_label\" :for=\"`q5t_${i}`\">是</label>\r\n\r\n                <input type=\"radio\" class=\"slist_radio_input\" :id=\"`q5f_${i}`\" :name=\"`q_${i}`\" required :value=\"false\" />\r\n                <label class=\"slist_radio_label\" :for=\"`q5f_${i}`\">否</label>\r\n                <!--\r\n                <tr>\r\n                  <td> <input type=\"radio\" :id=\"`q5t_${i}`\" :name=\"`q5_${i}`\" :disabled=\"disabled\" required :value=\"true\">\r\n                    <label :for=\"`q5t_${i}`\">是</label>\r\n                  </td>\r\n                  <td>\r\n                    <div class=\"col\">\r\n                      <input type=\"radio\" :id=\"`q5f_${i}`\" :name=\"`q5_${i}`\" :disabled=\"disabled\" required :value=\"false\">\r\n                      <label :for=\"`q5f_${i}`\">否</label>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n-->\r\n              </div>\r\n            </div>\r\n            <!--\r\n            <label class=\"form-check-label\">  \r\n              <input type=\"checkbox\" class=\"form-check-input\" name=\"monthQuestion\" :value=\"i\" :disabled=\"disabled\">{{ v.title }}\r\n            </label>\r\n            -->\r\n          </div>\r\n          <img :src=\"monthQuestions.image\" style=\"width: 100%\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <br />\r\n    <button v-if=\"!pass\" class=\"btn btn-primary\" type=\"submit\">確認</button>\r\n  </form>\r\n</template>\r\n\r\n<style>\r\n  .q_gray_line {\r\n    background-color: #f0f0f0;\r\n    padding: 5px;\r\n  }\r\n\r\n  .q_white_line {\r\n    background-color: white;\r\n    padding: 5px;\r\n  }\r\n\r\n  .slist_radio_input {\r\n    display: inline-block;\r\n    position: absolute;\r\n    opacity: 0;\r\n  }\r\n\r\n  .slist_radio_label {\r\n    text-align: center;\r\n    background-color: #dee2e6;\r\n    border-radius: 50%;\r\n    cursor: pointer;\r\n    position: relative;\r\n    width: 2.5rem;\r\n    height: 2.5rem;\r\n    margin: 0.1rem;\r\n    line-height: 2.5rem;\r\n  }\r\n\r\n  .slist_radio_input:checked + label {\r\n    -webkit-box-shadow: inset 0 0 0 2px #000000;\r\n    box-shadow: inset 0 0 0 2px #000000;\r\n  }\r\n</style>\r\n","<script setup lang=\"ts\">\r\n  import dayjs from \"dayjs\";\r\n  import {getDatabase, ref as fref, set, push, update} from \"firebase/database\";\r\nimport { ref } from \"vue\";\r\n\r\n  const props = defineProps<{\r\n    jsondata: Record<string, string>;\r\n  }>();\r\n\r\n  const registrationDate = dayjs(props.jsondata[\"registrationDate\"]);\r\n  const registrationDateStr = props.jsondata[\"registrationDate\"] || \"error\"\r\n  const registrationDateStrTw = registrationDate.year() - 1911 + registrationDate.format(\"年 MM月 DD日\");\r\n\r\n  const doneInfo = ref(false);\r\n\r\n  let pushdata = props.jsondata as Record<string, any>;\r\n  pushdata[\"unix\"] = dayjs().unix();\r\n\r\n  function pushUserData(data: Record<string, string>) {\r\n    doneInfo.value = false;\r\n    console.log(data);\r\n    const db = getDatabase();\r\n    push(fref(db, `register/`), {\r\n      data,\r\n    }).then((value) => {\r\n      console.log(value.key);\r\n      let updateData = {} as Record<string, any>\r\n      updateData[value.key + \"\"] = pushdata['keyday'] < 360 * 3;\r\n      update(fref(db, `registrationDate/` + registrationDateStr + \"/\" ), {\r\n        ...updateData\r\n      }).then(() => {\r\n        doneInfo.value = true;\r\n      }).catch(alert);\r\n    }).catch(alert);\r\n  }\r\n  pushUserData(props.jsondata);\r\n</script>\r\n<template>\r\n  <div v-if=\"!doneInfo\">報名申請送出中...</div>\r\n  <div v-if=\"doneInfo\">報名完成。預計看診日期為{{ registrationDateStrTw }}，經系統報名成功不等於掛號成功，經本院確認身份資格符合評估資格後，會再以電話通知。 未接到電話通知即不符合看診資格，請勿擅自前來看診，以免白跑一趟。</div>\r\n\r\n</template>\r\n","<script setup lang=\"ts\">\r\n  import { computed } from \"@vue/reactivity\";\r\n  import { ref, type Ref, type VNodeRef } from \"vue\";\r\n  import dayjs, { Dayjs } from \"dayjs\";\r\n  import { formPayload2Record } from \"@/Utils\";\r\n\r\n  const ageRangeMax = ref(dayjs(\"2022-07-01\").add(-106, \"day\"));\r\n  const ageRangeMin = ref(dayjs(\"2010-01-01\").add(-106, \"day\"));\r\n\r\n  // .add(-1911, 'year') 民國\r\n  const y1 = ref(ageRangeMin.value.format(\"YYYY年MM月DD日\"));\r\n  const y2 = ref(ageRangeMax.value.format(\"YYYY年MM月DD日\"));\r\n  const y3 = ref(ageRangeMin.value.format(\"YYYY年MM月DD日\"));\r\n  const y4 = ref(ageRangeMax.value.format(\"YYYY年MM月DD日\"));\r\n  const y5 = ref(ageRangeMax.value.format(\"YYYY年MM月DD日\"));\r\n\r\n  // const kidBirthdayStr: Ref<string> = ref(\"\");\r\n\r\n  const kidBirthdayStr: Ref<string> = ref(dayjs().format(\"YYYY-MM-DD\"));\r\n\r\n  const diffday = computed(() => Math.floor(dayjs().diff(kidBirthdayStr.value) / (1000 * 60 * 60 * 24)));\r\n\r\n  const kidBirthday = computed(() => dayjs(kidBirthdayStr.value));\r\n  const kidAgeStr = computed(() => {\r\n    return (diffday.value > 360 ? (Math.floor(diffday.value / 360) + \"年\"): \"\")\r\n    + (diffday.value > 30 ? (Math.floor(diffday.value%360 / 30)  + \"個月\"): \"\")\r\n    + (diffday.value > 0 ? ((diffday.value%360%30) + \"天\"): \"\")\r\n  });\r\n\r\n  const pass: Ref<boolean | null> = ref(null);\r\n  const props = defineProps<{\r\n    disabled: boolean;\r\n  }>();\r\n  const emit = defineEmits<{\r\n    (e: \"kidBirthdayChange\", kidBirthday: Dayjs): void;\r\n    (e: \"submit\", json: Record<string, string>, next: boolean): void;\r\n  }>();\r\n\r\n  function submit(payload: Event) {\r\n    emit(\"kidBirthdayChange\", kidBirthday.value);\r\n    pass.value = kidBirthday.value.isBefore(ageRangeMax.value) && kidBirthday.value.isAfter(ageRangeMin.value);\r\n    emit(\"submit\", Object.assign({}, formPayload2Record(payload), {kidDay: diffday.value}), pass.value);\r\n  }\r\n</script>\r\n<template>\r\n  <form id=\"from\" @submit.prevent=\"submit\">\r\n    <h1>兒童發展評估報名系統</h1>\r\n\r\n    正確年齡計算方式：<br />\r\n    「實足年齡」：「施測日期 - 出生日期 = 實足年齡」<br />\r\n    ＊早產兒二歲前建議以預產期代替出生日期計算<br />\r\n\r\n    <div class=\"kidBirthdayFrom\">\r\n      請選擇您的寶貝出生日期進行檢測：<br />\r\n      <label class=\"form-label\">\r\n        <input type=\"date\" class=\"form-control\" name=\"kidBirthday\" v-model=\"kidBirthdayStr\" required />\r\n      </label>\r\n      <!-- \r\n        <label class=\"form-label\">\r\n            <input type=\"button\" class=\"btn btn-primary\" style=\"vertical-align: inherit\" value=\"確認\" :onclick=\"kidBirthdayClick\" />\r\n        </label>\r\n        -->\r\n      <br />\r\n      試算結果：{{ kidAgeStr }}\r\n    </div>\r\n    <div class=\"col-md-12\" v-if=\"pass === false\">\r\n      <div class=\"alert alert-info\">\r\n        <!--\r\n        本年度符合收案區間的年齡為：{{ y1 }}至{{ y2 }}（每一年都會調整）。<br>\r\n        ‧出生日期為{{ y3 }}-{{ y4 }}，若媒合到適合就診日期為{{ y5 }}，則不符合收案年齡。<br>\r\n        -->\r\n        年齡不符合本院看診條件，若仍需要本院就診，建議轉診至以下科別：<br />\r\n        動作、語言類發展問題 &#8594; 請掛復健科<br />\r\n        認知、人際、情緒、專注力、過動等 &#8594; 請掛兒童心智科\r\n      </div>\r\n    </div>\r\n    <button v-if=\"!pass\" class=\"btn btn-primary\" type=\"submit\">確認</button>\r\n  </form>\r\n\r\n  <br />\r\n</template>\r\n\r\n<style>\r\n  .kidBirthdayFrom {\r\n    padding: 15px;\r\n    background-color: #f0f0f0;\r\n  }\r\n</style>\r\n","<script setup lang=\"ts\">\r\n  import {getRegistrationDate, getSetting, type settingT} from \"@/MyFirebase\";\r\n  import type {Dayjs} from \"dayjs\";\r\n  import dayjs from \"dayjs\";\r\n  import {getDatabase, onValue, ref as fref} from \"firebase/database\";\r\n  import {ref, computed} from \"vue\";\r\n\r\n  const props = defineProps<{\r\n    dateStr: string;\r\n    special: boolean;\r\n  }>();\r\n  const showDate = dayjs(props.dateStr);\r\n  const showDateStr = props.dateStr;\r\n  const showDateStrTw = showDate.year() - 1911 + showDate.format(\".MM.DD\");\r\n  const db = getDatabase();\r\n\r\n  const pnumber = ref(0);\r\n  const quota = ref(-1);\r\n  const isloading = ref(true);\r\n  const isfull = computed(() => pnumber.value < quota.value);\r\n  /*\r\n  async () => {\r\n    const setting = await getSetting();\r\n    const registrationDate = await getRegistrationDate(showDateStr)\r\n    pnumber.value = registrationDate ? Object.keys(registrationDate).length : 0;\r\n    quota.value = setting.quota + (props.special ? setting.specialQuota: 0)\r\n  }*/\r\n\r\n  Promise.all([getSetting(), getRegistrationDate(showDateStr)]).then(([setting, registrationDate]) => {\r\n    pnumber.value = registrationDate ? Object.keys(registrationDate).length : 0;\r\n    quota.value = setting.quota + (props.special ? setting.specialQuota : 0);\r\n    isloading.value = false;\r\n  });\r\n\r\n  const emit = defineEmits<{\r\n    (e: \"submit\", dateStr: string): void;\r\n  }>();\r\n\r\n  function onclickDate() {\r\n    emit(\"submit\", props.dateStr);\r\n  }\r\n</script>\r\n<template>\r\n  <div v-if=\"isloading\" class=\"text-center\">\r\n    <div class=\"spinner-border\" role=\"status\">\r\n      <span class=\"visually-hidden\">Loading...</span>\r\n    </div>\r\n  </div>\r\n\r\n  <tr v-if=\"!isloading\" class=\"tablebox\">\r\n\r\n    <td>\r\n\r\n      <a v-if=\"!isfull\" class=\"red\" :onclick=\"onclickDate\" style=\"white-space: nowrap\">【報名】</a> \r\n      <a v-if=\"isfull\" style=\"white-space: nowrap; color: red;\">報名額滿</a>\r\n      <br />&nbsp\r\n    </td>\r\n    <td>{{ showDateStrTw }}<br />已掛人數：{{ pnumber + \"/\" + quota }}</td>\r\n  </tr>\r\n</template>\r\n<style>\r\n  .tablebox td {\r\n    border-style: none;\r\n  }\r\n\r\n  div.bb {\r\n    padding: 1px;\r\n    margin-bottom: 8px;\r\n  }\r\n\r\n  span.d {\r\n    display: inline-block;\r\n    width: 39%;\r\n    height: 40px;\r\n    padding: 0px;\r\n    text-align: right;\r\n    line-height: 1;\r\n  }\r\n\r\n  span.b {\r\n    display: inline-block;\r\n    width: 61%;\r\n    height: 40px;\r\n    padding: 0px;\r\n    line-height: 1;\r\n  }\r\n\r\n  a {\r\n    text-decoration: none;\r\n    color: #09378a;\r\n  }\r\n\r\n  a.red:link {\r\n    color: #ff0000;\r\n  }\r\n  a.red:active {\r\n    color: #c90000;\r\n  }\r\n  a.red:visited {\r\n    color: #ff0000;\r\n  }\r\n  a.red:hover {\r\n    color: #c90000;\r\n  }\r\n</style>\r\n","<script setup lang=\"ts\">\r\n  import dayjs, {Dayjs} from \"dayjs\";\r\n  import {getDatabase, ref as fref, push, child, update, set, onValue, get} from \"firebase/database\";\r\n  import {getAuth} from \"firebase/auth\";\r\n  import {computed, ref, type Ref} from \"vue\";\r\n\r\n  import RegistrationTime from \"../components/RegistrationTime.vue\";\r\nimport { getSetting } from \"@/MyFirebase\";\r\n\r\n  const props = defineProps<{\r\n    jsondata: Record<string, any>;\r\n  }>();\r\n  const special = ref((props.jsondata[\"kidDay\"] as number) < 360*3)\r\n\r\n  // 系統以禮拜日 0 ，作為開始，但需求是以禮拜一開始。\r\n\r\n  const weeksStr = [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"];\r\n  const table: Ref<Dayjs[][][]> = ref([\r\n    [[], [], [], [], [], [], []],\r\n    [[], [], [], [], [], [], []],\r\n  ]);\r\n\r\n  type setting = {\r\n    dayofweek: number;\r\n    maxday: number;\r\n    minday: number;\r\n  };\r\n\r\n  getSetting().then(val => {\r\n    console.log(val);\r\n    checkConsultationTime(val.dayofweek, val.minday, val.maxday);\r\n  });\r\n\r\n\r\n  function checkConsultationTime(dayOfWeek: number, minday: number, maxday: number) {\r\n    let today = dayjs().add(minday, \"day\");\r\n    for(let i = minday;i < maxday;i++) {\r\n    //  console.log(today);\r\n      if(today.day() == dayOfWeek) {\r\n        table.value[0][dayOfWeek].push(today);\r\n      }\r\n      today = today.add(1, \"day\");\r\n    }\r\n  }\r\n\r\n\r\n  const emit = defineEmits<{\r\n    (e: \"submit\", payload: Record<string, string>, pass: boolean): void;\r\n  }>();\r\n\r\n  function submit(dateStr: string) {\r\n    emit(\"submit\", {registrationDate: dateStr}, true);\r\n  }\r\n</script>\r\n<template>\r\n  <h5>選擇看診日期</h5>\r\n\r\n  <table class=\"table table-sm\">\r\n    <thead class=\"weekhead\">\r\n      <tr>\r\n        <th>星期/<br />午別</th>\r\n\r\n        <th v-for=\"i in weeksStr.slice(1)\">星期{{ i }}</th>\r\n        <th>星期{{ weeksStr[0] }}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody class=\"weekbody\">\r\n      <tr>\r\n        <th class=\"weekside\">上午<br />08:30<br />~<br />12:00</th>\r\n        <td v-for=\"(v, i, a) in table[0].slice(1)\">\r\n          <RegistrationTime v-for=\"vv in v\" :dateStr=\"vv.format('YYYY-MM-DD')\" @submit=\"submit\" :special=\"special\"></RegistrationTime>\r\n        </td>\r\n        <td v-for=\"(v, i, a) in [table[0][0]]\">\r\n          <RegistrationTime v-for=\"vv in v\" :dateStr=\"vv.format('YYYY-MM-DD')\" @submit=\"submit\" :special=\"special\"></RegistrationTime>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <th class=\"weekside\">下午<br />13:30<br />~<br />17:00</th>\r\n        <td v-for=\"i in weeksStr\"></td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n  <br />\r\n</template>\r\n\r\n<style>\r\n  .weekhead tr th {\r\n    padding: 0px;\r\n    text-align: center;\r\n    background-color: #328aa4 !important;\r\n    color: white;\r\n  }\r\n  .weekside {\r\n    padding: 0px;\r\n    text-align: center;\r\n    background-color: #328aa4 !important;\r\n    color: white;\r\n  }\r\n\r\n  .weekbody tr td {\r\n    background-color: white !important;\r\n    border-width: 1px;\r\n    border-color: #328aa4;\r\n    border-left-width: 1px;\r\n    border-right-width: 1px;\r\n    color: black;\r\n  }\r\n</style>\r\n","<script setup lang=\"ts\">\r\n  import {type Ref, ref, computed} from \"vue\";\r\n  import ReadRegulations from \"@/components/ReadRegulations.vue\";\r\n  import UserFrom1 from \"../components/UserFrom1.vue\";\r\n  import UserFrom2 from \"../components/UserFrom2.vue\";\r\n  import UserFrom3 from \"../components/UserFrom3.vue\";\r\n  import UserFrom4 from \"../components/UserFrom4.vue\";\r\n  import UserFrom5 from \"../components/UserFrom5.vue\";\r\n  import type {Dayjs} from \"dayjs\";\r\n  import EndPage from \"../components/EndPage.vue\";\r\n  import UserFrom0 from \"../components/UserFrom0.vue\";\r\n  import RegistrationFrom from \"../components/RegistrationFrom.vue\";\r\n\r\n  // https://register.vghtc.gov.tw/register/listDoctor.jsp?init=init&section=REHA\r\n\r\n  const step = ref(-1);\r\n  const kidBirthday = ref(\"\");\r\n\r\n  function kidBirthdayChange(date: Dayjs) {\r\n    kidBirthday.value = date.format(\"YYYY-MM-DD\");\r\n    \r\n  }\r\n  const output_json = ref(\"\");\r\n  const allData: Record<string, string> = {};\r\n\r\n\r\n  function fromSubmit(payload: Record<string, string>, pass: boolean) {\r\n    if (!pass) {\r\n      return;\r\n    }\r\n    step.value += 1;\r\n    for (const k of Object.keys(payload)) {\r\n      allData[k] = payload[k];\r\n    }\r\n    output_json.value = JSON.stringify(allData, null, 2);\r\n  }\r\n\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <br />\r\n    <ReadRegulations />\r\n    \r\n\r\n    <UserFrom0 v-if=\"step == -1\" :disabled=\"step != -1\" @submit=\"fromSubmit\" @kid-birthday-change=\"kidBirthdayChange\" />\r\n\r\n    <RegistrationFrom v-if=\"step == 0\" @submit=\"fromSubmit\" :jsondata=\"allData\"/>\r\n\r\n    <UserFrom1 v-if=\"step == 1\" :disabled=\"step != 1\" @submit=\"fromSubmit\" />\r\n\r\n    <UserFrom2 v-if=\"step == 2\" :disabled=\"step != 2\" @submit=\"fromSubmit\" />\r\n\r\n    <UserFrom3 v-if=\"step == 3\" :disabled=\"step != 3\" @submit=\"fromSubmit\" />\r\n\r\n    <UserFrom4 v-if=\"step == 4\" :disabled=\"step != 4\" @submit=\"fromSubmit\" />\r\n\r\n    <UserFrom5 v-if=\"step == 5\" :disabled=\"step != 5\" @submit=\"fromSubmit\" :kid-birthday=\"kidBirthday\" />\r\n\r\n    <EndPage v-if=\"step == 6\" :jsondata=\"allData\" />\r\n\r\n    <br />\r\n  </div>\r\n  <!-- \r\n  <pre v-if=\"output_json && step == 6\" >\r\n  (開發用)\r\n  資料格式：{{ output_json }} \r\n  </pre>\r\n  -->\r\n</template>\r\n<style></style>\r\n"],"names":["fref","computed"],"mappings":"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"}